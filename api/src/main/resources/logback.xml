<?xml version="1.0" encoding="UTF-8"?>
<configuration debug="false" scan="true">
    <!-- Set the above debug attribute to true to see logback status information. -->

    <!-- The encoder uses a default class.  This can be changed using the class attribute -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!-- The log output format. UNIQUE_ID is a custom MDC variable passed from
                 the APIM down through the loadbalancer and proxy to the container.
                 It provides end to end request tracking.  A random string will be
                 generated by the servlet filter or thread initialization code when
                 one is not available in the http request header.
                 See TapisLoggingFilter for details. -->
            <Pattern>%date{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %class{36}:%line - %msg%n</Pattern>
        </encoder>
    </appender>

    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${tapis.log.directory:-${user.home}}/tapis-filesapi.log</file>
        <rollingPolicy
                class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- Rollover monthly, incorporate size-triggered sequence number. -->
            <fileNamePattern>${tapis.log.directory:-${user.home}}/tapis-filesapi.%d{yyyy-MM}.%i.log</fileNamePattern>
            <!-- Each file should be at most 500MB, keep 6 months worth of history,
                 but at most a total of 10GB across all log files. -->
            <maxFileSize>500MB</maxFileSize>
            <maxHistory>6</maxHistory>
            <totalSizeCap>5GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <!-- See console pattern for description. -->
            <Pattern>%date{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %class{36}:%line - %msg%n</Pattern>
        </encoder>
    </appender>

    <appender name="SSH_POOL_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${tapis.log.directory:-${user.home}}/tapis-filesapi-sshpool.log</file>
        <rollingPolicy
                class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- Rollover monthly, incorporate size-triggered sequence number. -->
            <fileNamePattern>${tapis.log.directory:-${user.home}}/tapis-filesapi-sshpool.%d{yyyy-MM}.%i.log</fileNamePattern>
            <!-- Each file should be at most 10MB, keep 6 months worth of history,
                 but at most a total of 50GB across all log files. -->
            <maxFileSize>10MB</maxFileSize>
            <maxHistory>5</maxHistory>
            <totalSizeCap>50MB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <!-- See console pattern for description. -->
            <Pattern>%date{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %class{36}:%line - %msg%n</Pattern>
        </encoder>
    </appender>


    <!-- Root logger's appenders are inherited by other loggers by default -->
    <root level="INFO">
        <appender-ref ref="STDOUT" />
        <appender-ref ref="FILE" />
    </root>

    <!-- Set additivity attribute to false to not inherit ancestor appenders. -->
    <logger name="edu.utexas.tacc.tapis" level="TRACE"/>

    <!-- Control library logging. -->
    <logger name="com.zaxxer.hikari" level="ERROR"/>

    <logger name="edu.utexas.tacc.tapis.shared.ssh" level="INFO"/>

    <!-- ssh session pooling logging.  set to "TRACE" for debugging message (very verbose) -->
    <logger name="edu.utexas.tacc.tapis.shared.ssh" level="DEBUG" additivity="false">
        <appender-ref ref="SSH_POOL_FILE"/>
    </logger>
</configuration>
